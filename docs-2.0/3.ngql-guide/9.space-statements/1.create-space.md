# CREATE SPACE

Graph spaces are used to store data in a physically isolated way in Nebula Graph, which is similar to the database concept in MySQL. The `CREATE SPACE` statement creates a new graph space with the given name.
<!-- 图空间是Nebula Graph中彼此隔离的图数据集合，与MySQL中的database概念类似。`CREATE SPACE`语句可以创建一个新的图空间，或者克隆现有图空间的Schema。 -->
## Prerequisites

Only the God role can use the `CREATE SPACE` statement. For more information, see [AUTHENTICATION](../../7.data-security/1.authentication/1.authentication.md).

## Syntax

<!-- ### 创建图空间 -->

```ngql
CREATE SPACE [IF NOT EXISTS] <graph_space_name> (
    [partition_num = <partition_number>,] 
    [replica_factor = <replica_number>,]
    vid_type = {FIXED_STRING(<N>) | INT[64]}
    )
    [COMMENT = '<comment>'];
```

|Parameter|Description|
|:---|:---|
|`IF NOT EXISTS`|Detects if the related graph space exists. If it does not exist, a new one will be created. The graph space existence detection here only compares the graph space name (excluding properties).|
|`<graph_space_name>`|Uniquely identifies a graph space in a Nebula Graph instance. The name of the graph space is case-sensitive and allows letters, numbers, or underlines. [Keywords and reserved words](../../3.ngql-guide/1.nGQL-overview/keywords-and-reserved-words.md) are not allowed.|
|`partition_num`|Specifies the number of partitions in each replica. The suggested number is five times the number of the hard disks in the cluster. For example, if you have 3 hard disks in the cluster, we recommend that you set 15 partitions. The default value is 100.|
|`replica_factor`|Specifies the number of replicas in the cluster. The suggested number is 3 in a production environment and 1 in a test environment. The replica number must be an **odd number** for the need of quorum-based voting. The default value is 1.|
|`vid_type`|A required parameter. Specifies the VID type in a graph space. Available values are `FIXED_STRING(N)` and `INT64`. `INT` equals to `INT64`. `FIXED_STRING(<N>)` specifies the VID as a string, while `INT64` specifies it as an integer. `N` represents the maximum length of the VIDs. If you set a VID that is longer than `N` characters, Nebula Graph throws an error.|
|`COMMENT`|The remarks of the graph space. The maximum length is 256 bytes. By default, there is no comments on a space.|

!!! caution

    If the replica number is set to one, you will not be able to load balance or scale out the Nebula Graph Storage Service with the [BALANCE](../../8.service-tuning/load-balance.md) statement.

!!! caution

    Restrictions on VID type change and VID length
    
    1. In Nebula Graph 1.x, the VID type can only be `INT64` and does not support string. In Nebula Graph 2.x, the VID type can be both `INT64` and `FIXED_STRING(<N>)`. You should specify the VID type when creating a graph space and keep consistency when using the `INSERT` statement. Otherwise, Nebula Graph throws `Wrong vertex id type: 1001`.
    
    2. The length of the VID should not be longer than `N` characters. If it exceeds `N`, Nebula Graph throws `The VID must be a 64-bit integer or a string fitting space vertex id length limit.`.

!!! compatibility "Legacy version compatibility"

    In the 2.x releases before 2.5.0, `vid_type` is not a required parameter and its default value is `FIXED_STRING(8)`.

!!! note

    `graph_space_name`, `partition_num`, `replica_factor`, `vid_type`, and `comment` cannot be modified once set. To modify them, drop the current working graph space with [`DROP SPACE`](./5.drop-space.md) and create a new one with `CREATE SPACE`.

<!-- 
### 克隆图空间

```ngql
CREATE SPACE <new_graph_space_name> AS <old_graph_space_name>;
```

|参数|说明|
|:---|:---|
|`<new_graph_space_name>`|目标图空间名称。该图空间必须未创建。图空间名称由大小写英文字母、数字或下划线组成，区分大写小，且不可使用[关键字和保留字](../../3.ngql-guide/1.nGQL-overview/keywords-and-reserved-words.md)。创建时会克隆`<old_graph_space_name>`图空间的Schema，包括图空间本身参数（分片数量、副本数量等），以及Tag、Edge type和原生索引。|
|`<old_graph_space_name>`|原始图空间名称。该图空间必须已存在。|
-->

## Examples

```ngql
# The following example creates a graph space with a specified VID type and the maximum length. Other fields still use the default values.
nebula> CREATE SPACE my_space_1 (vid_type=FIXED_STRING(30)); 

# The following example creates a graph space with a specified partition number, replica number, and VID type.
nebula> CREATE SPACE my_space_2 (partition_num=15, replica_factor=1, vid_type=FIXED_STRING(30));

#  The following example creates a graph space with a specified partition number, replica number, and VID type, and adds a comment on it.
nebula> CREATE SPACE my_space_3 (partition_num=15, replica_factor=1, vid_type=FIXED_STRING(30)) comment="Test the graph space"; 

# 克隆图空间。
nebula> CREATE SPACE my_space_4 as my_space_3;
nebula> SHOW CREATE SPACE my_space_4;
+--------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Space        | Create Space                                                                                                                                                            |
+--------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| "my_space_4" | "CREATE SPACE `my_space_4` (partition_num = 15, replica_factor = 1, charset = utf8, collate = utf8_bin, vid_type = FIXED_STRING(30)) ON default comment = '测试图空间'"  |
+--------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
```

## Implementation of the operation

!!! caution

    Trying to use a newly created graph space may fail because the creation is implemented asynchronously.
    
Nebula Graph implements the creation in the next heartbeat cycle. To make sure the creation is successful, take one of the following approaches:

- Find the new graph space in the result of [`SHOW SPACES`](3.show-spaces.md) or [`DESCRIBE SPACE`](4.describe-space.md). If you cannot, wait a few seconds and try again.

- Wait for two heartbeat cycles, i.e., 20 seconds.

To change the heartbeat interval, modify the `heartbeat_interval_secs` parameter in the [configuration files](../../5.configurations-and-logs/1.configurations/1.configurations.md) for all services. If the heartbeat interval is too short (i.e., less than 5 seconds), disconnection between peers may happen because of the misjudgment of machines in the distributed system.

## Check partition distribution

On some large clusters, the partition distribution is possibly unbalanced because of the different startup times. You can run the following command to do a check of the machine distribution.

```ngql
nebula> SHOW HOSTS;
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| Host        | Port | Status   | Leader count | Leader distribution            | Partition distribution         |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "storaged0" | 9779 | "ONLINE" | 8            | "basketballplayer:3, test:5"   | "basketballplayer:10, test:10" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "storaged1" | 9779 | "ONLINE" | 9            | "basketballplayer:4, test:5"   | "basketballplayer:10, test:10" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "storaged2" | 9779 | "ONLINE" | 3            | "basketballplayer:3"           | "basketballplayer:10, test:10" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "Total"     |      |          | 20           | "basketballplayer:10, test:10" | "basketballplayer:30, test:30" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
```

To balance the request loads, use the following command.

```ngql
nebula> BALANCE LEADER;
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| Host        | Port | Status   | Leader count | Leader distribution            | Partition distribution         |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "storaged0" | 9779 | "ONLINE" | 7            | "basketballplayer:3, test:4"   | "basketballplayer:10, test:10" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "storaged1" | 9779 | "ONLINE" | 7            | "basketballplayer:4, test:3"   | "basketballplayer:10, test:10" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "storaged2" | 9779 | "ONLINE" | 6            | "basketballplayer:3, test:3"   | "basketballplayer:10, test:10" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
| "Total"     |      |          | 20           | "basketballplayer:10, test:10" | "basketballplayer:30, test:30" |
+-------------+------+----------+--------------+--------------------------------+--------------------------------+
```
