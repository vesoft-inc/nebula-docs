# Full-text search

```ngql
LOOKUP ON {<tag> | <edge_type>} WHERE <expression> [YIELD <return_list>]

<expression> ::=
    PREFIX | WILDCARD | REGEXP | FUZZY

<return_list>
    <prop_name> [AS <prop_alias>] [, <prop_name> [AS <prop_alias>] ...]
```

- PREFIX(schema_name.prop_name, prefix_string, row_limit, timeout)
- WILDCARD(schema_name.prop_name, wildcard_string, row_limit, timeout)
- REGEXP(schema_name.prop_name, regexp_string, row_limit, timeout)
- FUZZY(schema_name.prop_name, fuzzy_string, fuzziness, operator, row_limit, timeout)
  - `fuzziness` (optional): Maximum edit distance allowed for matching. The default value is `AUTO`. For valid values and more information, see [Elasticsearch document](https://www.elastic.co/guide/en/elasticsearch/reference/6.8/common-options.html#fuzziness).
  - `operator` (optional): Boolean logic used to interpret text. Valid values are `OR` (default) and `AND`.
- `row_limit` (optional): Specifies the number of rows to return. The default value is 100.
- `timeout` (optional): Specifies the timeout time. The default value is 200ms.

Use the `LOOKUP ON` statement to do full-text search. The search string is specified in the `WHERE` clause.

## Natural language full-text search

A natural language search interprets the search string as a phrase in natural human language. The search is case-insensitive.

## Examples

```ngql

nebula> LOOKUP ON tag1 WHERE PREFIX(tag1.prop1, "a");
nebula> LOOKUP ON tag1 WHERE WILDCARD(tag1.prop1, "a");
nebula> LOOKUP ON tag1 WHERE REGEXP(tag1.prop1, "a");
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a");

nebula> LOOKUP ON tag1 WHERE PREFIX(tag1.prop1, "a", 1);
nebula> LOOKUP ON tag1 WHERE WILDCARD(tag1.prop1, "a", 1);
nebula> LOOKUP ON tag1 WHERE REGEXP(tag1.prop1, "a", 1);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 1);

nebula> LOOKUP ON tag1 WHERE PREFIX(tag1.prop1, "a", 1, 2);
nebula> LOOKUP ON tag1 WHERE WILDCARD(tag1.prop1, "a", 1, 2);
nebula> LOOKUP ON tag1 WHERE REGEXP(tag1.prop1, "a", 1, 2);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 1, 2);

nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", AUTO, AND);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", AUTO, OR);

nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 0, AND);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 0, OR);

nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 0, OR, 1);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 0, OR, 1, 1);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 0, OR, -1, 1);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 0, OR, 1, -1);
nebula> LOOKUP ON tag1 WHERE FUZZY(tag1.prop1, "a", 4, OR, 1, 1);

nebula> LOOKUP ON tag1 WHERE PREFIX(tag1.prop1, "a", AUTO, AND);
```

## Full-text search limitations (in v2.0.0-beta)

For now, full-text search has the following limitations:

- In Elasticsearch, the maximum indexing string length is 256 bytes.
- Multiple properties search is not supported in Nebula Graph 2.0.0-beta.
- Ideographic language Chinese does not have word delimiters. Therefore, the built-in full-text parser cannot determine where words begin and end in Chinese. Install the [elasticsearch-analysis-ik](https://github.com/medcl/elasticsearch-analysis-ik) to parse Chinese.
- The `WHERE` clause does not support logical expressions `AND` and `OR`.

LOOKUP ON player WHERE PREFIX(player.name, "h");
[ERROR (-8)]: fulltext index not found : nebula_test_tag
不支持多个tag查询
can not be applied to more than one property at a time (similar to a composite index)
返回结果排序，不支持，按照数据插入顺序返回
支持查询null吗,不支持索引的属性是null，查不出来 ignore nulls
LOOKUP ON player WHERE PREFIX(player.name, " ");
Empty set (time spent 37566/38223 us)
什么情况下需要重构es索引
和pipe使用有什么限制




LOOKUP ON player WHERE wildcard(player.name, "*ri*") YIELD player.name, player.age
+-----------------+-----------------+-----+
| _vid            | name            | age |
+-----------------+-----------------+-----+
| "Chris Paul"    | "Chris Paul"    | 33  |
+-----------------+-----------------+-----+
| "Boris Diaw"    | "Boris Diaw"    | 36  |
+-----------------+-----------------+-----+
| "Blake Griffin" | "Blake Griffin" | 30  |
+-----------------+-----------------+-----+

LOOKUP ON player WHERE PREFIX(player.name, "B");
+-----------------+
| _vid            |
+-----------------+
| "Boris Diaw"    |
+-----------------+
| "Ben Simmons"   |
+-----------------+
| "Blake Griffin" |
+-----------------+

LOOKUP ON player WHERE regexp(player.name, "R.*") YIELD player.name, player.age
+---------------------+---------------------+-----+
| _vid                | name                | age |
+---------------------+---------------------+-----+
| "Russell Westbrook" | "Russell Westbrook" | 30  |
+---------------------+---------------------+-----+

LOOKUP ON player WHERE wildcard(player.name, "*shi*") | YIELD count(*)
+----------+
| COUNT(*) |
+----------+
| 1        |
+----------+